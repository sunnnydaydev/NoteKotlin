# é›†åˆ

## æ¦‚è¿°

kotlinçš„é›†åˆå’Œjavaçš„ç¨å¾®æœ‰äº›åŒºåˆ«ï¼Œjavaä¸­å£°æ˜ä¸€ä¸ªé›†åˆåè¾¹å¯è½»æ¾å®ç°å¢åˆ æ“ä½œï¼Œkotlinä¾¿ä¸æ˜¯è¿™æ ·ï¼Œkotlinä¸­åˆ†ä¸ºå¯å˜é›†åˆã€ä¸å¯å˜é›†åˆã€‚

kotlinä¸­ Listã€Setã€Mapæ¥å£éƒ½æ˜¯ä¸å¯å˜çš„è¿™æ„å‘³ç€æˆ‘ä»¬å¯¹é›†åˆåªæœ‰è¯»çš„æƒé™æ— å†™çš„æƒé™ï¼Œæƒ³è¦æœ‰å†™çš„æƒé™å°±è¦ å£°æ˜ æˆ– è½¬ä¸º å¯å˜é›†åˆã€‚

Listã€Setã€Mapéƒ½ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä»¥Listä¸¾ä¸ªä¾‹å­

```kotlin
fun main() {

    val list4 = listOf("1", "2") //listOfä¸ºä¸å¯å˜é›†åˆ
    val list1 = arrayListOf("1")  // ArrayListå¯å˜é›†åˆ

    val list2: List<String> = list1// è½¬ä¸ºListæ¥å£åä¸å¯å˜ã€‚list2 ä¸å…·æœ‰ add removeæ“ä½œ
    val list3: MutableList<String> = list2 as MutableList<String>// è½¬ä¸ºMutableListæ¥å£åå¯å˜

}
```

å¯è§æƒ³è¦è½¬æ¢åªéœ€è¦ä¾èµ–Listå’ŒMutableListæ¥å£å°±è¡Œå•¦ã€‚

# åˆ›å»ºé›†åˆ

é€šè¿‡ç³»ç»Ÿæä¾›çš„æ ‡å‡†åº“èƒ½å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåˆ›å»ºé›†åˆ

- listOf<T>()
- setOf<T>()
- mutableListOf<T>()
- mutableSetOf<T>()
- mapOf<K,V>()
- mutableMapOf<K,V>()

- emptyList()
- emptySet()
- emptyMap()

```kotlin
fun main() {
    val listOf1 = listOf<String>()
    val listOf2 = listOf("1", "2")

    val set = setOf("1", "2")
    val mutableListOf = mutableListOf("1", "2")
    val mutableSetOf = mutableSetOf("1", "2")

    val pair1 = Pair(first = "name", second = "Carry")
    val pair2 = Pair(first = "name", second = "Carry")
    val mapOf1 = mapOf(pair1, pair2)
    val mapOf2 = mapOf("name" to "Carry")
    val mutableMapOf = mutableMapOf("name" to "Carry")
    val mutableMapOf1 = mutableMapOf<String, String>().apply {
        this["name"] = "Carry"
    }

    val emptyList = emptyList<String>()
    val emptySet = emptySet<String>()
    val emptyMap = emptyMap<String, String>()


    val arrayList = arrayListOf("1", "2")
    val arrayList2 = arrayListOf<Int>() // empty arrayList
}
```

æ³¨æ„å‡ ç‚¹ï¼š

- ä»¥é€—å·åˆ†éš”çš„é›†åˆå…ƒç´ åˆ—è¡¨ä½œä¸ºå‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ£€æµ‹å…ƒç´ ç±»å‹ã€‚
- åˆ›å»ºç©ºé›†åˆæ—¶ï¼Œé¡»æ˜ç¡®æŒ‡å®šç±»å‹ã€‚
- mapä¸­å­˜çš„æ˜¯Pairå¯¹è±¡ï¼Œé€šå¸¸ä½¿ç”¨ä¸­ç¼€å‡½æ•° to åˆ›å»ºã€‚to ç¬¦å·åˆ›å»ºäº†ä¸€ä¸ªçŸ­æ—¶å­˜æ´»çš„ Pair å¯¹è±¡ï¼Œå› æ­¤å»ºè®®ä»…åœ¨æ€§èƒ½ä¸é‡è¦æ—¶æ‰ä½¿ç”¨å®ƒã€‚ ä¸ºé¿å…è¿‡å¤šçš„å†…å­˜
  ä½¿ç”¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–æ–¹æ³•ã€‚å¦‚å€ŸåŠ©applyå‡½æ•°ã€‚

# é›†åˆçš„å¤åˆ¶

è¦åˆ›å»ºä¸ç°æœ‰é›†åˆå…·æœ‰ç›¸åŒå…ƒç´ çš„é›†åˆï¼Œå¯ä»¥ä½¿ç”¨å¤åˆ¶æ“ä½œã€‚æ ‡å‡†åº“ä¸­çš„é›†åˆå¤åˆ¶æ“ä½œåˆ›å»ºäº†å…·æœ‰ç›¸åŒå…ƒç´ å¼•ç”¨çš„ æµ… å¤åˆ¶é›†åˆã€‚ å› æ­¤ï¼Œå¯¹é›†åˆå…ƒç´ æ‰€åšçš„æ›´æ”¹ä¼š
åæ˜ åœ¨å…¶æ‰€æœ‰å‰¯æœ¬ä¸­ã€‚

åœ¨ç‰¹å®šæ—¶åˆ»é€šè¿‡é›†åˆå¤åˆ¶å‡½æ•°ï¼Œä¾‹å¦‚toList()ã€toMutableList()ã€toSet() ç­‰ç­‰ã€‚åˆ›å»ºäº†é›†åˆçš„å¿«ç…§ã€‚ ç»“æœæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ç›¸åŒå…ƒç´ çš„æ–°é›†åˆ å¦‚æœåœ¨æº
é›†åˆä¸­æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ï¼Œåˆ™ä¸ä¼šå½±å“å‰¯æœ¬ã€‚å‰¯æœ¬ä¹Ÿå¯ä»¥ç‹¬ç«‹äºæºé›†åˆè¿›è¡Œæ›´æ”¹ã€‚

```kotlin
fun main() {
    val mutableListOf = mutableListOf("init")
    val toList = mutableListOf.toMutableList()

    /**
     * éªŒè¯å†…å­˜åœ°å€ä¸€è‡´
     * listOf1:3237167
     * toList:3237167
     * */
    println("listOf1:${mutableListOf.hashCode()}")
    println("toList:${toList.hashCode()}")

    /**
     * éªŒè¯ä½¿ç”¨ktç±»åº“æä¾›çš„apiåˆ›å»ºçš„å‰¯æœ¬ï¼Œé’ˆå¯¹å‰¯æœ¬æ“ä½œä¸ä¼šå½±å“æºé›†åˆ
     * mutableListOf:initã€mutableListOf:1
     * toList:initã€toList:2
     * */
    mutableListOf.add("1")
    toList.add("2")
    mutableListOf.forEach {
        println("mutableListOf:${it}")
    }
    toList.forEach {
        println("toList:${it}")
    }

    /**
     * éªŒè¯åŸå§‹çš„å¼•ç”¨èµ‹å€¼æ–¹å¼åˆ›å»ºçš„å‰¯æœ¬é’ˆå¯¹å‰¯æœ¬ä¿®æ”¹ä¼šå½±å“æºé›†åˆ
     * mutableListOf1:initã€mutableListOf1:1
     * */
    val mutableListOf1 = mutableListOf("init")
    val mutableListOf2 = mutableListOf1
    mutableListOf2.add("1")
    mutableListOf1.forEach {
        println("mutableListOf1:${it}")
    }

}
```

# é›†åˆçš„è¿­ä»£

Iteratoræ˜¯åŸºç±»æ¥å£ï¼Œå®šä¹‰äº†å¦‚ä¸‹è§„èŒƒï¼š

```kotlin
public interface Iterator<out T> {
    /**
     * è·å–å½“å‰å…ƒç´ ï¼Œå¹¶å°†æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€å…ƒç´ ã€‚
     * */
    public operator fun next(): T

    /**
     * æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ 
     * */
    public operator fun hasNext(): Boolean
}
```

ListIterator æ‰©å±•äº†åŸºç±»æ”¯æŒåˆ—è¡¨çš„åŒå‘è¿­ä»£ï¼š

```kotlin
public interface ListIterator<out T> : Iterator<T> {
    // Query Operations
    override fun next(): T
    override fun hasNext(): Boolean

    /**
     * Returns `true` if there are elements in the iteration before the current element.
     */
    public fun hasPrevious(): Boolean

    /**
     * Returns the previous element in the iteration and moves the cursor position backwards.
     */
    public fun previous(): T

    /**
     * Returns the index of the element that would be returned by a subsequent call to [next].
     */
    public fun nextIndex(): Int

    /**
     * Returns the index of the element that would be returned by a subsequent call to [previous].
     */
    public fun previousIndex(): Int
}
```
MutableIteratoræ‰©å±•äº†Iteratorå¯ä»¥åœ¨è¿­ä»£æ—¶å¢ã€åˆ ã€æ›´æ–°å…ƒç´ ï¼š

```kotlin
public interface MutableListIterator<T> : ListIterator<T>, MutableIterator<T> {
    // Query Operations
    override fun next(): T
    override fun hasNext(): Boolean

    // Modification Operations
    override fun remove(): Unit

    /**
     * Replaces the last element returned by [next] or [previous] with the specified element [element].
     */
    public fun set(element: T): Unit

    /**
     * å½“å‰å…ƒç´ ä¹‹å‰æ’å…¥æ–°çš„å…ƒç´ ã€‚
     */
    public fun add(element: T): Unit
}
```

å¦‚ä½•è·å–å¯å˜é›†åˆè¿­ä»£å™¨å‘¢ï¼Ÿå¾ˆç®€å•å¯å˜é›†åˆç›´æ¥è°ƒç”¨apiå³å¯ã€‚

```kotlin
    val iterableList  =  listOf("1","2","3")
    val  iterator = iterableList.toMutableList().listIterator()
```

```kotlin
    val iterableList  =  listOf("1","2","3")
    val  iterator = iterableList.toMutableList().listIterator()
     iterator.next() //é»˜è®¤å½“å‰å…ƒç´ ä¸ºé¦–ä¸ªå…ƒç´ ï¼Œè°ƒç”¨nextåå½“å‰å…ƒç´ æŒ‡å‘"2"
     iterator.add("test") // æ­¤æ—¶é›†åˆä¸º"1","test"ï¼Œ"2","3",å½“å‰å…ƒç´ è¿˜æ˜¯æŒ‡å‘"2"
     println("current:${iterator.next()}") //æ­¤æ—¶åº”æ‰“å°"2",ç„¶åå½“å‰å…ƒç´ æŒ‡å‘3

log ->
current:2
```

# åºåˆ—

å›é¡¾ä¸‹é›†åˆçš„mapæ“ä½œï¼Œå…¶å®mapæ˜¯Iterableçš„ä¸€ä¸ªæ‰©å±•å‡½æ•° ->

```kotlin
public inline fun <T, R> Iterable<T>.map(transform: (T) -> R): List<R> {
    return mapTo(ArrayList<R>(collectionSizeOrDefault(10)), transform)
}
```

åºåˆ—Sequence<T>æä¾›äº†ä¸Iterable<T>ç›¸åŒçš„å‡½æ•°ï¼Œä½†å®ç°å¦ä¸€ç§æ–¹æ³•æ¥è¿›è¡Œ å¤šæ­¥éª¤ é›†åˆå¤„ç†ã€‚


###### 1ã€åºåˆ—çš„åˆ›å»º

ï¼ˆ1ï¼‰é€šè¿‡api sequenceOf

ï¼ˆ2ï¼‰é€šè¿‡Iterableï¼ˆListæˆ–setï¼‰å¯¹è±¡çš„api asSequence

ï¼ˆ3ï¼‰generateSequence api

ï¼ˆ4ï¼‰sequence{}

åä¸¤ç§åˆ›å»ºæ–¹å¼ä½¿ç”¨è¾ƒå°‘ï¼Œå¯ä»¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£äº†è§£ä¸‹~

###### 2ã€åºåˆ—ä¸é›†åˆçš„åŒºåˆ«

é›†åˆæ‰§è¡Œä¸€äº›åˆ—æ“ä½œæ—¶ï¼šä¼šä¾æ¬¡æ‰§è¡Œæ¯ä¸ªæ­¥éª¤åŒæ—¶è·å–åˆ°æ­¥éª¤æ‰§è¡Œçš„ä¸­é—´ç»“æœé›†åˆï¼Œåœ¨æ­¤é›†åˆä¸Šç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤ã€‚

åºåˆ—æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œæ—¶ï¼šåºåˆ—ä¼šå¯¹æ¯ä¸€ä¸ªå…ƒç´ é€ä¸ªæ‰§è¡Œæ‰€æœ‰å¤„ç†æ­¥éª¤ã€‚

å¯è§åºåˆ—å¯é¿å…ç”Ÿæˆä¸­é—´æ­¥éª¤çš„ç»“æœï¼Œä»è€Œæé«˜äº†æ•´ä¸ªé›†åˆå¤„ç†é“¾çš„æ€§èƒ½ã€‚ ä½†æ˜¯ï¼Œåºåˆ—çš„å»¶è¿Ÿæ€§è´¨å¢åŠ äº†ä¸€äº›å¼€é”€ï¼Œè¿™äº›å¼€é”€åœ¨å¤„ç†è¾ƒå°çš„é›†åˆæˆ–è¿›è¡Œæ›´ç®€å•çš„è®¡ç®—
æ—¶å¯èƒ½å¾ˆé‡è¦ã€‚ å› æ­¤ï¼Œåº”è¯¥åŒæ—¶è€ƒè™‘ä½¿ç”¨ Sequence ä¸ Iterableï¼Œå¹¶ç¡®å®šåœ¨å“ªç§æƒ…å†µæ›´é€‚åˆã€‚

æ —å­ ğŸŒ°

å‡å®šæœ‰ä¸€ä¸ªå•è¯åˆ—è¡¨ã€‚è¦æ±‚è¿‡æ»¤é•¿åº¦å¤§äº3ä¸ªå­—ç¬¦çš„å•è¯ï¼Œå¹¶æ‰“å°å‰å››ä¸ªå•è¯çš„é•¿åº¦ã€‚

ä½¿ç”¨é›†åˆæˆ‘ä»¬ä¼šè¿™æ ·åšï¼š

```kotlin
//1ã€å­—ç¬¦ä¸²è½¬list
val words = "The quick brown fox jumps over the lazy dog".split(" ")

//2ã€é›†åˆæ“ä½œä¾æ¬¡æ‰§è¡Œ
val lengthsList = words.filter {
    it.length > 3 // é•¿åº¦å¤§äº3çš„ç­›é€‰å‡ºæ¥ï¼Œç»“æœæ˜¯ä¸€ä¸ªå­é›†åˆã€‚
}
    .map {
        it.length // string é›†åˆè½¬ä¸º inté›†åˆ
    }
    .take(4) //å–inté›†åˆå…ƒç´ å‰4ä¸ª
println("Lengths of first 4 words longer than 3 chars:")
println(lengthsList)
```

![åºåˆ—](https://gitee.com/sunnnydaydev/my-pictures/raw/master/github/kt/Iterable.png)

ä½¿ç”¨åºåˆ—æˆ‘ä»¬ä¼šè¿™æ ·åšï¼š

```kotlin
// 1ã€å­—ç¬¦ä¸²è½¬é›†åˆ
val words = "The quick brown fox jumps over the lazy dog".split(" ")
// 2ã€é›†åˆè½¬æ¢ä¸ºåºåˆ—
val wordsSequence = words.asSequence()

// 3ã€åŒæ ·çš„æ“ä½œï¼Œä¸è¿‡æ¯ä¸ªå…ƒç´ ä¾æ¬¡æ‰§è¡Œä¸‹åˆ—æ“ä½œã€‚
val lengthsSequence = wordsSequence.filter {
    it.length > 3
}
    .map {
        it.length
    }
    .take(4)

println("Lengths of first 4 words longer than 3 chars")
// æœ«ç«¯æ“ä½œï¼šè·å–ç»“æœã€‚
println(lengthsSequence.toList())
```

![åºåˆ—](https://gitee.com/sunnnydaydev/my-pictures/raw/master/github/kt/Sequence.png)

###### 3ã€åºåˆ—ä¸å¼‚æ­¥æµåŒºåˆ«ï¼Ÿ

åºåˆ—æ˜¯åŒæ­¥è®¡ç®—ï¼Œå¼‚æ­¥æµï¼ˆFlowï¼‰æ˜¯å¼‚æ­¥è®¡ç®—ã€‚

###### 4ã€åºåˆ—æ³¨æ„ç‚¹

å¦‚æœåºåˆ—æ“ä½œè¿”å›å»¶è¿Ÿç”Ÿæˆçš„å¦ä¸€ä¸ªåºåˆ—ï¼Œåˆ™ç§°ä¸º ä¸­é—´åºåˆ—ã€‚å¦‚è°ƒç”¨äº†toList()ã€‚

æ²¡æœ‰ç”Ÿæˆæ–°çš„åºåˆ—åˆ™æœ€åçš„æ“ä½œå«æœ«ç«¯æ“ä½œï¼Œå¦‚ mapã€filterã€takeã€dropç­‰ã€‚åªèƒ½é€šè¿‡æœ«ç«¯æ“ä½œæ‰èƒ½æ£€ç´¢åºåˆ—å…ƒç´ ã€‚

# The end

æ›´å¤šé›†åˆæ“ä½œå¯å‚è€ƒè¿™é‡Œ

[é›†åˆæ“ä½œæ¦‚è¿°](https://www.kotlincn.net/docs/reference/collection-operations.html)




